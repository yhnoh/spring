### Spring Batch 소개
---

- Spring Batch는 배치 어플리케이션을 개발할 수 있도록 설계된 프레임워크이다.
- 대량의 레코드를 처리하는 데 필수적인 기능을 재공한다.
  - 배치작업에 대한 로깅/추적
  - 트랜잭션 관리
  - 정크 기반 처리
  - 작업 처리 통계
  - 작업 시작, 종료, 재시작
  - 작업 재시도, 건너뛰기
  - 함수형 I/O 제공
  - 웹 기반 관리자 인터페이스 제공 ([Sptring Cloud Data Flow](https://spring.io/projects/spring-cloud-dataflow))
  - 리소스 관리 
  - 최적화 및 파티셔닝 기술을 제공하여 효율적이고 효과적인 배치 가능
  - 복잡한 대량 배치 작업을 확장성 있게 작업 가능
- 위의 기능에 의해 복잡한 대량 배치, 많은 양의 레코드 처리등에 효율적, 효과적, 확장성이 있는 처리가 가능하다.
- 스프링 배치는 스케쥴러 서비스가 아니기 때문에 특정 시간마다 실행시키려면 스케쥴러 서비스와 함께 사용하는 것이 좋다. 
  - Quartz, Tivoli, Control-M, ...

### 일반적인 배치 처리 방식
---

1. 데이터베이스, 파일 또는 큐에서 많은 수의 레코드를 읽는다.
2. 개발자가 작성한 로직에 따라서 데이터를 처리, 가공한다.
3. 처리, 가공된 데이터를 데이터베이스, 파일, 큐에 다시 작성한다.

### 배치 작업 시 주로 고려하는 것들
---

- 주기적으로 일괄 치리
- 동시 일괄 처리 (병렬 처리)
- 단계적인 메세지, 이벤트 기반 처리
- 대규모 병렬 처리
- 실패 후 수동 또는 재시도 처리
- 종속 단계에 따른 순차적인 처리
- 작업의 일부분만 처리

### Spring Batch가 해결하고자 하는 기술적인 목표
---

- 프레임워크를 활용하기 때문에 개발자가 비지니스 로직에만 집중하고 나머지 인프라적인 부분은 Spring Batch가 처리
- 인프라, 배치 실행 환경 및 배치 애플리케이션 간의 문제를 명확하게 분리
- 핵심 인터페이스에 대한 기본적인 구현 모델을 제공
- 모든 계층에서 스프링 프레임워크를 활용하여 서비스를 쉽게 구성하고 사용자 정의 및 확장 가능
- 기존의 모든 핵심 서비스는 인프라 계층에 영향을 주지 않고 쉽게 교체하거나 확장 가능
- Jar로 통해 간단한 배포 모델 제공

### Spring Batch Architecture
---

![](./img/spring-batch-layers.png)
- Spring Batch acchitecture는 어플리케이션, 배치 코어, 인프라 세계의 계층으로 이루어져 있다.
- 어플리케이션은 개발자가 만든 Job들과 사용자 정의 코드로 이루어져 있다.
- 배치 코어는 배치 작업을 시작하고 제어하는데 필요한 핵심 런타임 클래스들이 포함되어 있다.
  - JobLauncher, Job, Step에 대한 구현들도 포함된다.
- 인프라에는 애플리케이션과 배치 코어가 모두 사용하는 readers, writers, service가 포함된다.
  
### Spring Batch 가이드라인
---

- 가능한한 단순화하고 복잡한 논리적인 로직을 작성하지 마라.
- 데이터 처리및 저장에 관련된 물리적인 장치를 최대한 가깝게 하라.
- I/O를 최소한으로 하고 내부 메모리에서 가능한한 많은 작업을 수행하라.
- 데이터 무결성을 유지하기 위하여 유효성 검사를 하라.
- 처리 집계에 대한 유효성 처리를 하라.
  - 예를 들어 100개의 데이터중 50개의 데이터만 작성해야하는 경우, 작성해야할 개수를 미리 구하여 유효성 체크를 하라.
- 가능한한 운영환경과 유사한 스트레스 테스트를 진행하라.
- 데이터베이스는 읿반적으로 백업 구성이 잘되어 있지만 파일 백업은 아닌경우가 많으니 백업 구성을 잘해둬라.

### 배치 전략
---


#### Reference
> - [spring-batch](https://spring.io/projects/spring-batch)
> - [spring-batch-introdution](https://docs.spring.io/spring-batch/docs/current/reference/html/spring-batch-intro.html#spring-batch-intro)