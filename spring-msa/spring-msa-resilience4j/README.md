- 성능이 나쁜 원격 서비스가 야기하는 문제를 탐지하기 어려울 뿐만 아니라 전체 어플리케이션 생태계에 파급되는 연쇄 효과를 유발할 수 있다.
    - 때문에 보호 장치가 없다면 불량한 서비스 하나가 빠르게 여러 어플리케이션을 다운시킬 수 있다.
  
#### 클라이언트 측 회복성이란?
- 클라이언트 측 회복성 소프트웨어 패턴들은 원격 자원들을 호출할 때 에러나 성능 저하로 실패할 경우 클라이언트가 고장나지 않게 보호하는데 중점을 둔다.
  - 이러한 패턴들을 활용할 경우 클라이언트가 빨리 실패하고 데이터베이스 커넥션과 스레드 풀 같은 소중한 자원을 소비하는 것을 방짛라 수 있다.

#### 클라이언트 측 로드 밸런싱
- 서비스 소비자가 서비스 인스턴스를 호출해야할 때
- 클라이언트 측 로드 밸런서가 문제를 탐지하면 가용 서비스 플에서 문제된 서비스 인스턴스를 제거하여 해당 서비스 인스턴스로 더 이상 호출되지 않는다.

#### 회로 차단기 (circuit breaker pattern)
- 회로 차단기는 원격 서비스가 호출될 때 호출을 모니터링한다. 호출이 너무 오래 걸리면 차단기가 개입해서 호출을 종료한다.
  - 원격 자원에 대한 모든 호출을 모니터링, 고장난 원격 자원에 대한 추가 호출 방지 

#### 폴백 처리 (fallback pattern)
- 원격 서비스 호출이 실패할 때 예외를 생성하지 않고 서비스 소비자가 대체 코드 경로를 실행하여 다른 수단을 통해 작업을 수행할 수 있다.
  - 다른 데이터 소스를 찾거나 향후 처리를 위해 사용자 요청을 큐에 입력

#### 벌크 헤드 (bulkhead pattern)
- 원격 자원에 대한 호출을 자원별 스레드 풀로 분리하면, 느린 원격 자원 호출 하나로 발생한 문제가 전체 애플리케이션을 다운시킬 위험을 줄일 수 있다.
  - 원격 자원을 분리하여 스레드 풀에 각각 할당한다.
  - 스레드 풀별로 서비스를 할당하면 다른 서비스는 포화되지 않기 때문에 병목현상을 우회할 수 있다.

#### Resilience4j
- 네트워크 문제나 여러 서비스의 고장으로 발생하는 결함 내성을 높이기 위한 패턴ㅇ들을 제공하낟.
  - 회로 차단기 (circuit breaker) : 요청받은 서비스가 실패할 때 요청을 중단
  - 재시도 (retry) : 서비스가 일시적으로 실패할 때 재시도 한다.
  - 벌크헤드 (bulkhead) : 과부하를 피하고자 동시 호출하는 서비스 요청 수를 제한
  - 속도 제한 (rate limit) : 서비스가 한 번에 수신하는 호출 수를 제한
  - 폴백 (fallback) : 실패하는 요청에 대해 대체 경로를 설정
- Resilienece4j 구현 방법을 두가지 큰 범주에서 살펴보면
  - 해당 서비스 내에서 데이터베이스에 대한 모든 호출을 래핑
  - 다른 원격 서비스에간의 호출을 래핑

#### 회로 차단기 패턴 (circuit breaker pattern)
- 원격 자원과 해당 자원을 소비하는 소비자 사이에 위치하기 때문에 서비스 실패를 가로채서 다른 대안을 취할 수 있다.
  - 이러한 대안을 폴백 전략이라고 하며 쉽게 구현이 가능하다.
  - `@CircuitBreaker(name = "", fallbackMethod = "")`어노테이션에서 fallbackMethod 속성을 추가하여 사용할 수 있다.
  - fallbackMethod는 원래 메서드와 동일 매개변수를 가지도록 설정해야 하며, 반환 형식도 동일해야한다. 
    - Thrwoable 매개변수를 가질 수 있다.
- 폴백 함수 주의 사항
  - 폴백 서비스에서 다른 원격 자원을 호출하는 경우 @CircuitBreaker로 그 폴백을 래핑해야할 수 있다.

#### 벌크헤드 패턴 구현 (bulkhead pattern)
- 원격 자원 호출을 자체 스레드 풀에 격리해서 한 서비스의 오작동을 억제하고 컨테이너를 멈추지 않게한다.
  - 만약 대규모 요청이나, 원격 자원의 어떤 문제로 인해서 요청 스레드가 대기 상태에 있을 경우 같은 스레드풀에 존재할 때, 새로운 작업 요들이 후순위로 대기하게 되면 결국 자바 컨테이너는 멈추게 된다.
- Resilience4j의 두가지 벌크헤드 패턴
  - 세마포어 벌크헤드 (semaphore bulkhead): 세마포어 격리 방식으로 서비스에 대한 동시 요청 수를 제한한다. 한계에 도달하면 요청을 거부한다.
    - 어플리케이션에서 엑세스하는 원격 자원의 수가 적고 각 서비스에 대한 호출랴이 상대적으로 고르게 분산되어 있는 경우 잘 작동한다.
    - 다른 서비스보다 호출량이 많거나 완료되는 데 오래 걸리는 서비스가 있다면, 한 서비스가 기본 스레드 풀의 모든 스레드를 점유하기 때문에 모든 스레드를 소진하게 된다.
  - 스레드 풀 벌크 헤드 (thread pool bulkhead): 제한된 큐와 스레드 풀을 사용한다. 풀과 큐가 다 찬 경우만 요청을 거부한다.
    - 